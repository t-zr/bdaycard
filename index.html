<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title>üéâ Birthday Card üéâ</title>
<link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600&family=Great+Vibes&family=Orbitron:wght@700&display=swap" rel="stylesheet" />
<style>
  html, body {
    margin: 0; padding: 0;
    height: 100vh;
    background: #f0e7db;
    display: flex; justify-content: center; align-items: center;
    font-family: 'Fredoka', sans-serif;
    user-select: none;
    overflow: hidden;
  }

  #cardContainer {
    width: 350px;
    height: 480px;
    perspective: 2500px;
    position: relative;
    cursor: pointer;
    box-shadow: 0 15px 30px rgba(0,0,0,0.3);
    border-radius: 15px;
    background: transparent;
    transition: box-shadow 0.3s ease;
    z-index: 10;
  }
  #cardContainer:hover {
    box-shadow: 0 25px 45px rgba(0,0,0,0.45);
  }

  #cardContainer::before {
    content: '';
    position: absolute;
    top: 20px; bottom: 20px;
    left: 50%;
    width: 3px;
    background: linear-gradient(180deg, rgba(0,0,0,0.04), rgba(0,0,0,0.12), rgba(0,0,0,0.04));
    border-radius: 2px;
    transform: translateX(-50%);
    z-index: 20;
    pointer-events: none;
  }

  .card {
    width: 100%;
    height: 100%;
    position: relative;
    transform-style: preserve-3d;
    transition: transform 1.25s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    border-radius: 15px;
    box-shadow: inset 0 0 10px rgba(0,0,0,0.1);
  }
  .card.open {
    transform: rotateY(-180deg);
    cursor: default;
    box-shadow: none;
  }

  .card-face {
    position: absolute;
    width: 100%;
    height: 100%;
    top: 0; left: 0;
    border-radius: 15px;
    background: #fffef9;
    box-shadow:
      0 6px 15px rgba(0,0,0,0.12);
    padding: 30px 25px;
    box-sizing: border-box;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    backface-visibility: hidden;
    background-image:
      radial-gradient(rgba(0,0,0,0.02) 1px, transparent 2px),
      radial-gradient(rgba(0,0,0,0.015) 1px, transparent 2px);
    background-position: 0 0, 25px 25px;
    background-size: 50px 50px;
    user-select: none;
  }

  .card-front {
    background: linear-gradient(135deg, #ffcee7 25%, #ffe5f0 100%);
    color: #d81e5b;
    font-size: 2.4em;
    font-weight: 700;
    text-align: center;
    text-shadow: 2px 2px 6px #ffacd4;
    cursor: pointer;
    user-select: none;
    position: relative;
  }
  .card-front::before {
    content: "HAPPY BIRTHDAY";
    position: absolute;
    top: 25px;
    width: 100%;
    font-size: 0.9em;
    letter-spacing: 0.15em;
    color: #f48fb1;
    text-shadow:
      1px 1px 0 white,
      -1px -1px 0 white,
      1px -1px 0 white,
      -1px 1px 0 white;
    user-select: none;
  }
  .decorations {
    margin-top: auto;
    display: flex;
    justify-content: center;
    gap: 20px;
    font-size: 2.8em;
    user-select: none;
  }

  .card-back {
    transform: rotateY(180deg);
    font-family: 'Great Vibes', cursive;
    font-size: 1.7em;
    color: #444;
    text-align: center;
    padding: 60px 40px;
    line-height: 1.5;
    user-select: text;
    position: relative;
  }

  #ageBadge {
    position: absolute;
    top: 15px;
    right: 15px;
    background: linear-gradient(45deg, #ffd700, #ff69b4);
    color: white;
    padding: 8px 18px;
    border-radius: 20px;
    font-weight: 600;
    font-size: 0.9em;
    box-shadow: 0 4px 15px rgba(255, 105, 180, 0.5);
    user-select: none;
    display: none;
    z-index: 30;
  }

  .music-note {
    position: absolute;
    color: #ff69b4;
    font-size: 1.4em;
    animation: musicFloat 3s ease-in-out infinite;
    user-select: none;
  }
  .music-note:nth-child(1) { top: 20%; left: 15%; }
  .music-note:nth-child(2) { top: 30%; right: 20%; animation-delay: 0.5s; }
  .music-note:nth-child(3) { bottom: 25%; left: 20%; animation-delay: 1s; }
  .music-note:nth-child(4) { bottom: 35%; right: 15%; animation-delay: 1.5s; }

  @keyframes musicFloat {
    0%, 100% { transform: translateY(0px) rotate(0deg); opacity: 0.7; }
    50% { transform: translateY(-20px) rotate(10deg); opacity: 1; }
  }

  /* Balloon floating */
  .floating-elements {
    position: fixed;
    width: 100vw;
    height: 100vh;
    pointer-events: none;
    z-index: 5;
    top: 0;
    left: 0;
  }

  .balloon {
    position: absolute;
    font-size: 2em;
    animation: float 6s ease-in-out infinite;
    user-select: none;
  }
  .balloon:nth-child(1) { left: 10%; animation-delay: 0s; }
  .balloon:nth-child(2) { left: 85%; animation-delay: 1s; }
  .balloon:nth-child(3) { left: 20%; animation-delay: 2s; }
  .balloon:nth-child(4) { left: 75%; animation-delay: 3s; }
  @keyframes float {
    0%, 100% { transform: translateY(0px) rotate(0deg); }
    50% { transform: translateY(-20px) rotate(5deg); }
  }

  /* Sparkle */
  .sparkle {
    position: fixed;
    color: #ffd700;
    font-size: 1.5em;
    animation: sparkle 3s linear infinite;
    user-select: none;
    pointer-events: none;
  }
  @keyframes sparkle {
    0% { opacity: 0; transform: scale(0) rotate(0deg); }
    50% { opacity: 1; transform: scale(1) rotate(180deg); }
    100% { opacity: 0; transform: scale(0) rotate(360deg); }
  }

  /* Confetti */
  .confetti {
    position: fixed;
    width: 12px;
    height: 12px;
    border-radius: 50%;
    background-color: pink;
    animation: fall linear infinite;
    z-index: 15;
    user-select: none;
    pointer-events: none;
  }
  @keyframes fall {
    0% {
      transform: translateY(-10px) rotate(0deg);
      opacity: 1;
    }
    100% {
      transform: translateY(100vh) rotate(720deg);
      opacity: 0;
    }
  }

  /* Firework */
  .firework {
    position: fixed;
    width: 4px;
    height: 4px;
    border-radius: 50%;
    animation: firework 2s ease-out infinite;
    z-index: 15;
    user-select: none;
    pointer-events: none;
  }
  @keyframes firework {
    0% {
      transform: scale(0);
      opacity: 1;
    }
    50% {
      transform: scale(1);
      opacity: 0.8;
    }
    100% {
      transform: scale(2);
      opacity: 0;
    }
  }

  @media (max-width: 400px) {
    #cardContainer {
      width: 90vw;
      height: auto;
    }
    .card-front {
      font-size: 1.8em;
    }
    .card-back {
      font-size: 1.3em;
      padding: 40px 25px;
    }
    .decorations {
      font-size: 2.2em;
      gap: 15px;
    }
    #ageBadge {
      font-size: 0.75em;
      padding: 6px 12px;
    }
  }
</style>
</head>
<body>
  <div class="floating-elements" aria-hidden="true">
    <div class="balloon">üéà</div>
    <div class="balloon">üéà</div>
    <div class="balloon">üéà</div>
    <div class="balloon">üéà</div>
  </div>

  <div id="cardContainer" aria-label="Birthday Card" role="button" tabindex="0">
    <div class="card" id="card">
      <div class="card-face card-front" aria-hidden="false" id="cardFront">
        <div class="decorations" aria-hidden="true">
          <span>üéâ</span>
          <span>üéÇ</span>
          <span>üéÅ</span>
        </div>
        <span style="margin-top: 40px;">Tap to open your surprise! üéâ</span>
      </div>

      <div class="card-face card-back" aria-hidden="true" id="cardBack" tabindex="-1">
        <div id="msgLine1"></div>
        <div id="msgLine2" style="margin-top: 15px;"></div>
        <div class="music-note" aria-hidden="true">üéµ</div>
        <div class="music-note" aria-hidden="true">üé∂</div>
        <div class="music-note" aria-hidden="true">üéµ</div>
        <div class="music-note" aria-hidden="true">üé∂</div>
        <div id="ageBadge" aria-label="Age Badge"></div>
      </div>
    </div>
  </div>

<script>
  let cardOpened = false;
  let audioContext;
  let sparkleInterval;
  let fireworkInterval;

  function getNameFromURL() {
    const params = new URLSearchParams(window.location.search);
    return params.get('name')?.trim() || 'Friend';
  }

  function getAgeFromURL() {
    const params = new URLSearchParams(window.location.search);
    return params.get('age')?.trim() || null;
  }

  function createSparkles() {
    const sparkleCount = 15;
    for (let i = 0; i < sparkleCount; i++) {
      setTimeout(() => {
        const sparkle = document.createElement('div');
        sparkle.className = 'sparkle';
        sparkle.innerHTML = '‚ú®';
        sparkle.style.left = Math.random() * 100 + 'vw';
        sparkle.style.top = Math.random() * 100 + 'vh';
        sparkle.style.animationDelay = Math.random() * 2 + 's';
        document.body.appendChild(sparkle);
        setTimeout(() => sparkle.remove(), 3000);
      }, i * 100);
    }
  }

  function createFireworks() {
    const fireworkColors = ['#ff69b4', '#ffd700', '#40e0d0', '#ff6b6b', '#9b59b6', '#2ecc71'];
    const fireworkCount = 20;
    
    for (let i = 0; i < fireworkCount; i++) {
      setTimeout(() => {
        const firework = document.createElement('div');
        firework.className = 'firework';
        firework.style.left = Math.random() * 100 + 'vw';
        firework.style.top = Math.random() * 100 + 'vh';
        firework.style.backgroundColor = fireworkColors[Math.floor(Math.random() * fireworkColors.length)];
        firework.style.animationDelay = Math.random() * 1 + 's';
        document.body.appendChild(firework);
        setTimeout(() => firework.remove(), 2000);
      }, i * 50);
    }
  }

  function launchConfetti() {
    const confettiColors = ['#ff69b4', '#ffd700', '#40e0d0', '#ff6b6b', '#9b59b6', '#2ecc71', '#e74c3c', '#f39c12'];
    const confettiShapes = ['‚óè', '‚òÖ', '‚ô¶', '‚ô†', '‚ô•', '‚ô£', '‚ñ≤', '‚ñ†'];
    
    for (let i = 0; i < 100; i++) {
      setTimeout(() => {
        const confetti = document.createElement('div');
        confetti.className = 'confetti';
        confetti.innerHTML = confettiShapes[Math.floor(Math.random() * confettiShapes.length)];
        confetti.style.left = Math.random() * 100 + 'vw';
        confetti.style.top = '-20px';
        confetti.style.color = confettiColors[Math.floor(Math.random() * confettiColors.length)];
        confetti.style.animationDuration = (2 + Math.random() * 4) + 's';
        confetti.style.animationDelay = Math.random() * 2 + 's';
        confetti.style.fontSize = (0.8 + Math.random() * 0.8) + 'em';
        document.body.appendChild(confetti);
        setTimeout(() => confetti.remove(), 8000);
      }, i * 30);
    }
  }

  function playBirthdayTune() {
    try {
      audioContext = new (window.AudioContext || window.webkitAudioContext)();

      const notes = [
        261.63, 261.63, 293.66, 261.63, 349.23, 329.63,
        261.63, 261.63, 293.66, 261.63, 392.00, 349.23,
        261.63, 261.63, 523.25, 440.00, 349.23, 329.63, 293.66,
        466.16, 466.16, 440.00, 349.23, 392.00, 349.23
      ];

      const durations = [
        0.5, 0.25, 0.75, 0.75, 0.75, 1.5,
        0.5, 0.25, 0.75, 0.75, 0.75, 1.5,
        0.5, 0.25, 0.75, 0.75, 0.75, 0.75, 1.5,
        0.5, 0.25, 0.75, 0.75, 0.75, 1.5
      ];

      let currentTime = audioContext.currentTime;

      notes.forEach((frequency, index) => {
        const oscillator = audioContext.createOscillator();
        const gainNode = audioContext.createGain();

        oscillator.connect(gainNode);
        gainNode.connect(audioContext.destination);

        oscillator.type = 'triangle';
        oscillator.frequency.value = frequency;

        gainNode.gain.setValueAtTime(0.3, currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, currentTime + durations[index]);

        oscillator.start(currentTime);
        oscillator.stop(currentTime + durations[index]);

        currentTime += durations[index];
      });

      setTimeout(() => playCheerSound(), 2000);

    } catch (error) {
      console.warn('Audio playback failed:', error);
    }
  }

  function playCheerSound() {
    if (!audioContext) return;

    const frequencies = [440, 554, 659, 880];
    let time = audioContext.currentTime;

    frequencies.forEach((freq, i) => {
      const osc = audioContext.createOscillator();
      const gain = audioContext.createGain();

      osc.connect(gain);
      gain.connect(audioContext.destination);

      osc.type = 'square';
      osc.frequency.value = freq;

      gain.gain.setValueAtTime(0.2, time);
      gain.gain.exponentialRampToValueAtTime(0.01, time + 0.3);

      osc.start(time);
      osc.stop(time + 0.3);

      time += 0.1;
    });
  }

  function startCelebration() {
    if (cardOpened) return;
    cardOpened = true;

    const card = document.getElementById('card');
    card.classList.add('open');

    // Accessibility: update aria-hidden
    document.getElementById('cardFront').setAttribute('aria-hidden', 'true');
    document.getElementById('cardBack').setAttribute('aria-hidden', 'false');
    document.getElementById('cardBack').focus();

    launchConfetti();
    createSparkles();
    createFireworks();
    playBirthdayTune();

    sparkleInterval = setInterval(createSparkles, 3000);
    fireworkInterval = setInterval(createFireworks, 4000);

    setTimeout(() => {
      clearInterval(sparkleInterval);
      clearInterval(fireworkInterval);
    }, 20000);
  }

  // Keyboard accessibility (Enter or Space triggers flip)
  document.getElementById('cardContainer').addEventListener('keydown', e => {
    if ((e.key === 'Enter' || e.key === ' ') && !cardOpened) {
      e.preventDefault();
      startCelebration();
    }
  });

  // Click to open card
  document.getElementById('cardContainer').addEventListener('click', startCelebration);

  // Initialize message and age badge on load
  window.onload = () => {
    const name = getNameFromURL();
    const age = getAgeFromURL();

    document.getElementById('msgLine1').textContent = `üéà HAPPY BIRTHDAY, ${name.toUpperCase()}! üéà`;
    document.getElementById('msgLine2').textContent = `Wishing you a happy birthday and a wonderful year! üéÇ‚ú®üéâ`;

    const badge = document.getElementById('ageBadge');
    if (age) {
      badge.textContent = `üéà ${age} Years Amazing! üéà`;
      badge.style.display = 'block';
    } else {
      badge.style.display = 'none';
    }

    createSparkles();
    setInterval(createSparkles, 8000);
  };
</script>
</body>
</html>
